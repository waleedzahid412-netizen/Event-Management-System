@using Event_Management_System.Models.Entities
@model IEnumerable<Event>

@{
    ViewData["Title"] = "My Events";

    var upcomingEvents = (ViewBag.SelectedTab == "upcoming") ? Model.ToList() : new List<Event>();
    var completedEvents = (ViewBag.SelectedTab == "completed") ? Model.ToList() : new List<Event>();
}

<h2 class="mb-4">🎤 My Events</h2>

<div class="mb-4">
    <a asp-action="MyEvents" asp-route-status="upcoming"
       class="btn btn-outline-primary @(ViewBag.SelectedTab == "upcoming" ? "active" : "")">
        ⏳ Upcoming Events
    </a>
    <a asp-action="MyEvents" asp-route-status="completed"
       class="btn btn-outline-success @(ViewBag.SelectedTab == "completed" ? "active" : "")">
        ✅ Completed Events
    </a>
</div>


<div class="row row-cols-1 row-cols-md-3 g-4">

    @if (ViewBag.SelectedTab == "upcoming")
    {
        @if (!upcomingEvents.Any())
        {
            <p class="text-muted">No upcoming events.</p>
        }
        else
        {
            @foreach (var ev in upcomingEvents)
            {
                <div class="col">
                    <div class="card event-card h-100">
                        <div class="position-relative">
                            <img src="@ev.CoverImageUrl" class="card-img-top event-img" />
                            <span class="badge-category">@ev.Category?.CategoryName</span>
                            <span class="badge-seats">🎟 @ev.AvailableSeats</span>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5>@ev.Title</h5>
                            <p class="card-text mb-3">
                                <strong>Start:</strong> @ev.StartDate.ToString("MMM dd, yyyy") <br />
                                <strong>End:</strong> @ev.EndDate.ToString("MMM dd, yyyy")
                            </p>
                            <div class="mt-auto d-flex justify-content-between gap-2">
                                <a asp-controller="Organizer" asp-action="ViewEventParticipants" asp-route-id="@ev.EventId" class="btn btn-success btn-sm">👥 Participants</a>
                                <a asp-controller="Organizer" asp-action="EventDetails" asp-route-id="@ev.EventId" class="btn btn-primary btn-sm">🔍 Details</a>
                                <a asp-controller="Organizer" asp-action="EditEvent" asp-route-id="@ev.EventId" class="btn btn-warning btn-sm">✏️ Edit</a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
    }
    else if (ViewBag.SelectedTab == "completed")
    {
        @if (!completedEvents.Any())
        {
            <p class="text-muted">No completed events.</p>
        }
        else
        {
            @foreach (var ev in completedEvents)
            {
                <div class="col">
                    <div class="card event-card h-100 border border-success">
                        <div class="position-relative">
                            <img src="@ev.CoverImageUrl" class="card-img-top event-img" />
                            <span class="badge-category bg-success">Completed</span>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5>@ev.Title</h5>
                            <p class="card-text mb-3">
                                <strong>Ended:</strong> @ev.EndDate.ToString("MMM dd, yyyy")
                            </p>
                            <div class="mt-auto d-flex justify-content-between gap-2">
                                <a asp-controller="Organizer" asp-action="ViewEventParticipants" asp-route-id="@ev.EventId" class="btn btn-success btn-sm">👥 Participants</a>
                                <a asp-controller="Organizer" asp-action="EventDetails" asp-route-id="@ev.EventId" class="btn btn-primary btn-sm">🔍 Details</a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
    }

</div>
